document.addEventListener('DOMContentLoaded', function() {
// 1. Verificação segura de autenticação e perfil
const token = localStorage.getItem('authToken') || localStorage.getItem('jwtToken');
let userData = {};

try {
const userDataString = localStorage.getItem('userProfile') ||
localStorage.getItem('userData') ||
'{}';
userData = JSON.parse(userDataString);
} catch (e) {
console.error('Erro ao processar dados do usuário:', e);
// Limpa dados inválidos e redireciona
localStorage.removeItem('userProfile');
localStorage.removeItem('userData');
window.location.href = '../views/login.html';
return;
}

// Redirecionamento se não autenticado
if (!token) {
window.location.href = '../views/login.html';
return;
}

// 2. Verificação robusta se NÃO é profissional
const isProfessional = (
(Array.isArray(userData.roles) && userData.roles.includes('ROLE_PROFISSIONAL')) ||
['CNPJ', 'PROFISSIONAL'].includes(userData.tipo) ||
(userData.cnpj && userData.cnpj.trim() !== '')
);

if (!isProfessional) {
window.location.href = '../views/inicial.html';
return;
}

// 3. Efeitos interativos para admin
const adminCards = document.querySelectorAll('.admin-card');
adminCards.forEach(card => {
card.addEventListener('click', () => {
card.style.transform = 'scale(0.98)';
setTimeout(() => card.style.transform = 'scale(1)', 200);
});
});

// 4. Configuração segura do botão de logout
const logoutButton = document.getElementById('logoutButton');
if (logoutButton) {
logoutButton.addEventListener('click', function() {
// Limpeza completa de todos os possíveis tokens
['authToken', 'jwtToken', 'userProfile', 'userData', 'userInfo'].forEach(item => {
localStorage.removeItem(item);
});
window.location.href = '../views/login.html';
});
}

// 5. Função global de navegação
window.navigateTo = function(page) {
window.location.href = page;
};

console.log('Página admin carregada com sucesso para:', userData);
});